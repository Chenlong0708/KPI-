<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>KPI Tracker (Local Save)</title>
  <style>
    body {
      font-family: "Microsoft YaHei", sans-serif;
      margin: 20px;
      background: #f4f6f9;
    }
    h1, h2 {
      color: #1a6dcc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      margin-top: 20px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
    }
    th {
      background: #1a6dcc;
      color: white;
    }
    input, textarea, select {
      width: 100%;
      box-sizing: border-box;
      padding: 5px;
      margin: 2px 0;
    }
    button {
      margin: 5px 0;
      padding: 6px 12px;
      background: #1a6dcc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .kpi-group {
      background: #eaf2ff;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h1>KPI Tracker (æœ¬åœ°å­˜å‚¨ç‰ˆ)</h1>

<label>é€‰æ‹©å‘¨æ¬¡ï¼š
  <input type="week" id="weekInput" onchange="loadWeekData()" />
</label>
<button onclick="saveWeekData()">ğŸ’¾ ä¿å­˜å½“å‰å‘¨æ•°æ®</button>
<button onclick="addKpiGroup()">â• æ·»åŠ æ–°KPI</button>

<table id="kpiTable">
  <thead>
    <tr>
      <th>KPI / æ ¸å¿ƒç›®æ ‡</th>
      <th>å…³é”®è¡ŒåŠ¨</th>
      <th>æœ¬å‘¨å›é¡¾</th>
      <th>ä¸‹å‘¨è®¡åˆ’</th>
      <th>è´£ä»»äºº</th>
      <th>æ“ä½œ</th>
    </tr>
  </thead>
  <tbody id="tableBody">
    <!-- åˆå§‹KPIåˆ†ç»„ -->
    <tr class="kpi-group">
      <td colspan="6">å®¢æˆ·æ»¡æ„åº¦ â‰¥ 90% <button onclick="addActionRow(this)">æ·»åŠ å­è¡ŒåŠ¨</button></td>
    </tr>
    <tr>
      <td></td>
      <td><input /></td>
      <td><textarea></textarea></td>
      <td><textarea></textarea></td>
      <td><input /></td>
      <td><button onclick="removeRow(this)">åˆ é™¤</button></td>
    </tr>
  </tbody>
</table>

<script>
function addKpiGroup() {
  const tbody = document.getElementById("tableBody");
  const kpiRow = document.createElement("tr");
  kpiRow.className = "kpi-group";
  kpiRow.innerHTML = `<td colspan="6"><input placeholder="æ–°KPIç›®æ ‡" /> <button onclick="addActionRow(this)">æ·»åŠ å­è¡ŒåŠ¨</button></td>`;
  tbody.appendChild(kpiRow);
  addActionRow(kpiRow.querySelector("button"));
}

function addActionRow(button) {
  const groupRow = button.closest("tr");
  const newRow = document.createElement("tr");
  newRow.innerHTML = `
    <td></td>
    <td><input /></td>
    <td><textarea></textarea></td>
    <td><textarea></textarea></td>
    <td><input /></td>
    <td><button onclick="removeRow(this)">åˆ é™¤</button></td>`;
  groupRow.parentNode.insertBefore(newRow, groupRow.nextSibling);
}

function removeRow(btn) {
  btn.closest("tr").remove();
}

function saveWeekData() {
  const week = document.getElementById("weekInput").value;
  if (!week) return alert("è¯·å…ˆé€‰æ‹©å‘¨æ¬¡ï¼");
  const rows = [...document.getElementById("tableBody").rows];
  const data = rows.map(row => {
    return [...row.cells].map(cell => {
      const el = cell.querySelector("input, textarea");
      return el ? el.value : cell.innerText.trim();
    });
  });
  localStorage.setItem("kpi_" + week, JSON.stringify(data));
  alert("âœ… å½“å‰å‘¨æ•°æ®å·²ä¿å­˜ï¼");
}

function loadWeekData() {
  const week = document.getElementById("weekInput").value;
  const saved = localStorage.getItem("kpi_" + week);
  if (!saved) return;
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";
  const rows = JSON.parse(saved);
  rows.forEach(cells => {
    const tr = document.createElement("tr");
    if (cells[0] && !cells[1]) {
      tr.className = "kpi-group";
      tr.innerHTML = `<td colspan="6">${cells[0]} <button onclick="addActionRow(this)">æ·»åŠ å­è¡ŒåŠ¨</button></td>`;
    } else {
      tr.innerHTML = `
        <td></td>
        <td><input value="${cells[1] || ""}"/></td>
        <td><textarea>${cells[2] || ""}</textarea></td>
        <td><textarea>${cells[3] || ""}</textarea></td>
        <td><input value="${cells[4] || ""}"/></td>
        <td><button onclick="removeRow(this)">åˆ é™¤</button></td>`;
    }
    tbody.appendChild(tr);
  });
}
</script>

</body>
</html>
